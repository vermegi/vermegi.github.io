---
title: "Extending Durandal"
layout: post
permalink: "/2014/02/extending-durandal.html"
uuid: "3910215904686920823"
guid: "tag:blogger.com,1999:blog-4315928131887373364.post-3910215904686920823"
date: "2014-02-09 09:58:00"
updated: "2014-02-09 09:58:51"
description: 
blogger:
    siteid: "4315928131887373364"
    postid: "3910215904686920823"
    comments: "0"
categories: [MVVM, MVC, durandal, Aspnet]
author: "Gitte Vermeiren"
background: "/img/durandal.png"
---

<div class="css-full-post-content js-full-post-content">
<h4>Summary: combining Durandal and ASP .Net MVC, getting the best of both worlds</h4><div><br /></div>Experience has taught me that, when doing web projects, JavaScript is one of the technologies you will have to learn to live with. It will always be present and it will always bug you (literally). And in each project, you will have devs at your disposal who are better, or worse at writing JavaScript code. It's just a fact that, once you start writing a whole bunch of JavaScript, it can get quite messy, very quickly.&nbsp;<div><br /></div><div>In my recent project setup, I wanted to be able to avoid such a mess, by providing well structured JavaScript code from the beginning. But, without having to sacrifice the comfortable environment the ASP .Net MVC framework gives to my devs.<br /><div><br /></div><div>For this, I looked into a couple of JavaScript frameworks. Without treading into details here, the framework that suited my situation best was <a href="http://durandaljs.com/">Durandal</a>. It's not that hard to learn, it makes extensive use of <a href="http://requirejs.org/">RequireJS</a> (which was already known by a lot of my developers) and it uses <a href="http://knockoutjs.com/index.html">knockout</a> for its bindings, which, for people coming from for instance XAML, looks quite familiar.&nbsp;</div><div><br /></div></div><div>For people unfamiliar to Durandal, knockout or RequireJS, you can find very good info for getting started with all three of them.&nbsp;</div><div><br /></div><div>Now, the problem with my recent project, was the combination of the good parts of ASP .Net MVC and the good parts of Durandal. For instance, what I like about ASP .Net MVC is the fact I can use statically typed helpers in my HTML. They help my devs a lot at being consistent and at keeping the error rate low(er). Kinda like what <a href="http://stackoverflow.com/questions/14981833/how-can-i-use-cshtml-files-with-durandal">this stackoverflow question</a> poses. So I started thinking of an easy way to accomplish this.&nbsp;</div><div><br /></div><div>My application itself will consist of little mini-SPA's. Meaning that for each part of the application, for instance the detail of a customer, or the overview of payments, ... we will make a Single Page Application (SPA). The starting point of each of these little mini-SPA's will be a .cshtml view which will get returned by an action on a controller. This .cshtml view will contain a div for the applicationHost (this is standard Durandal) and some code to start up an SPA on this page.&nbsp;</div><div><br /></div><div><script src="https://gist.github.com/vermegi/8896718.js"></script></div><div><br /></div><div>As you can see, this is standard Durandal code. The only thing I did was make my own little module that sets up an SPA for a certain viewmodel, so you don't have to repeat that code over and over again in the application.</div><div><br /></div><div>Now, what durandal does once you set up an SPA for barcode/shell, is that it starts looking for barcode/shell.js (your viewmodel) and barcode/shell.html (your view) and it links these two together. But the thing is, I actually want to set up a view in which I can use the MVC helpers. That's not possible in an HTML file.&nbsp;</div><div><br /></div><div>So, I started digging in the Durandal source code, looking for the part where the viewmodel and the view get linked together. Its in Durandals viewLocator.js file. In here, I added some extra script, giving you the ability to add an extra div (I called it applicationContent, out of convenience) in your original .cshtml file (lines 15 through 18).&nbsp;</div><div><br /></div><div><script src="https://gist.github.com/vermegi/8896807.js"></script></div><div><br /></div><div>Once you start up you SPA Durandal will now look for the presence of this div and if it can find one, it will put its contents in the applicationHost div. You can now use this abbility in your .cshtml file:</div><div><br /></div><div><script src="https://gist.github.com/vermegi/8896820.js"></script></div><div><br /></div><div>As you can see I can now use things like Html.BeginForm or our Translations resource in the cshtml file. It's all placed in a div called applicationContent. Once my SPA starts up, it will place this content in the applicationHost. You also have the ability to use knockout bindings inside your applicationContent. You can see I did this for the submit binding on the form and for the pdf_url in the iframe.&nbsp;</div><div><br /></div><div>If you want to look at this extension of Durandal:<a href="https://github.com/vermegi/Durandal"> I forked the project with my little addition</a>.</div><div><br /></div><div><br /></div>
</div>